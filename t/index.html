<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Google+Sans|Roboto|Roboto+Mono|Material+Icons">
  <title>t</title>
  <style>
    * {
      user-select: none;
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    body {
      background: black;
      font-family: Consolas, "Google Sans", "Roboto", "Roboto Mono", "Material Icons", "Open Sans", sans-serif, serif;
      color: white;
    }

    header {
      text-align: center;
    }

    header:hover {
      color: gray;
    }

    main {
      font-size: 180%;
      height: 10em;
      align-items: center;
      justify-content: center;
      display: flex;    
    }

    footer {
      display: inline;
      text-align: center;
      margin-top: 5em;
    }

    p {
      margin: 0;
    }

    a {
      color: black;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <header>
    <p>
      <div id="today" style="margin-top: 3em; font-size: 560%">Hi, Tuấn!</div>
    </p>
  </header>
  <main>
    <p>
      <div id="notif"></div>
    </p>
  </main>
  <footer>
    <a>;</a>
  </footer>
  <script>
    var t = [
      {
        markAs: "Sun",
        detail: [],
      },
      { 
        markAs: "Mon",
        detail: [
          {
            time: "1230-1550",
            room: "D6-405",
            subject: "Computer Architectures",
            id: "118185",
          },
          {
            time: "1600-1730",
            room: "D6-405",
            subject: "Object-Oriented Programming",
            id: "118181",
          },
        ],
      },
      {
        markAs: "Tue",
        detail: [],
      },
      {
        markAs: "Wed",
        detail: [
          {
            time: "1230-1455",
            room: "D6-403",
            subject: "Mathematical Statistics",
            id: "118183",
          },
          {
            time: "1600-1730",
            room: "D6-403",
            subject: "Operating Systems",
            id: "118182",
          },
        ],
      },
      {
        markAs: "Thu",
        detail: [
          {
            time: "1230-1400",
            room: "D6-405",
            subject: "Object-Oriented Programming",
            id: "118181",
          },
          {
            time: "1600-1730",
            room: "D6-405",
            subject: "Data Structures and Algorithms",
            id: "118184",
          },
        ],
      },
      {
        markAs: "Fri",
        detail: [
          {
            time: "1230-1550",
            room: "D6-403",
            subject: "Computation Programming",
            id: "118186",
          },
        ],
      },
      {
        markAs: "Sat",
        detail: [],
      },
    ];

    var d = new Date();
    var hasAlerted = false;
    var safeStyle = "style=\"color: green;\"";
    var notSafeStyle = "style=\"color: red;\"";
    var normalStyle = "style=\"color: yellow;\"";
    var notReadStyle = "style=\"color: white;\"";
    var readStyle = "style=\"color: gray;\"";
    var timeToUpdate = 60000;

    function getNotif() {
      var hour = "" + d.getHours();
      var minute = "" + d.getMinutes();
      hour = hour.length == 2 ? hour : "0" + hour;
      minute = minute.length == 2 ? minute : "0" + minute;
      var time = "" + hour + minute;
      var detail = t[d.getDay()]["detail"];
      var subjects = detail.length;
      var notif = hour + ":" + minute;
      var aTag = "<a " + normalStyle + ">";
      var notReadATag = "<a " + notReadStyle + ">";
      if (subjects == 0) {
        notif = aTag.replace(normalStyle, safeStyle) + notif + "</a><br>";
        notif += notReadATag + "Không có lớp học nào cho ngày hôm nay." + "</a><br>";
        if (!hasAlerted) {
          alert("Không có lớp học nào cho ngày hôm nay.");
          hasAlerted = true;
        }
      }
      else {
        notif = aTag + notif + "</a><br>";
        for (var i = 0; i < subjects; i++) {
          var startTime = detail[i]["time"].substring(0, 4);
          var endTime = detail[i]["time"].substring(5);
          if (time < startTime) {
            var tempTime = detail[i]["subject"] +
                           " tại phòng " + detail[i]["room"] +
                           " bắt đầu lúc " + startTime.substring(0, 2) + ":" +
                                             startTime.substring(2) + ".";
            if (startTime - time <= 30) {
              notif += notReadATag + "Sắp có lớp học " + tempTime + "</a><br>";
              notif = notif.replace(aTag, aTag.replace(normalStyle, notSafeStyle));
              alert("Sắp có lớp học " + tempTime);
            }
            else {
              notif += notReadATag + "Có lớp học " + tempTime + "</a><br>";
            }
          }
          else if (time >= startTime && time < endTime) {
            notif += notReadATag + "Đang trong thời gian học lớp " + detail[i]["subject"] +
                                   " tại phòng " + detail[i]["room"] +
                                   " kết thúc lúc " + endTime.substring(0, 2) + ":" +
                                                      endTime.substring(2) + "." + "</a><br>";
          }
          else if (i == subjects - 1 && time >= endTime) {
            notif += notReadATag + "Không còn lớp học nào cho ngày hôm nay." + "</a><br>";
            notif = notif.replace(aTag, aTag.replace(normalStyle, safeStyle));
          }
        }
      }
      return notif;
    }

    function replaceAll(str, subStr, repStr) {
      while (str.includes(subStr)) {
        str = str.replace(subStr, repStr);
      }
      return str;
    }

    function clickToHide() {
      document.getElementById("can-hide").style.display = "none";
    }

    var justDoIt = function() {
      d = new Date();
      document.getElementById("today").innerHTML = t[d.getDay()]["markAs"] + "day";
      var notif = "" + document.getElementById("notif").innerHTML;
      if (notif.length > 120) {
        hasAlerted = false;
        document.getElementById("today").style.display = "none";
      }
      var readATag = "<a " + readStyle + ">";
      var canHideTag = "<div id=\"can-hide\" onclick=\"clickToHide()\">";
      document.getElementById("notif").innerHTML = canHideTag +
                                                   replaceAll(
                                                     replaceAll(
                                                       replaceAll(
                                                         replaceAll(notif, normalStyle, readStyle),
                                                         notSafeStyle,
                                                         readStyle
                                                       ),
                                                       safeStyle,
                                                       readStyle
                                                     ),
                                                     notReadStyle,
                                                     readStyle
                                                   ) +
                                                   "</div>" + getNotif();
      window.scrollTo(0, document.body.scrollHeight || document.documentElement.scrollHeight);
    };

    setTimeout(function() {
      document.getElementById("today").style.marginTop = "2em";
      document.getElementById("today").style.fontSize = "300%";
      document.getElementById("today").innerHTML = t[d.getDay()]["markAs"] + "day";
      setTimeout(justDoIt, 1000);
    }, 1500);

    setInterval(function() {
      location.reload();
    }, 900000);

    setInterval(justDoIt, timeToUpdate);
  </script>
</body>